# Эксперименты на линейных моделях
## Рассмотренные модели
Выбор моделей осуществлялся кроссвалидацией на 4 фолдах (кроме LinearRegression()).  
Все числовые признаки масштабировались в пайплайне внутри кроссвалидации применением Standardscaler(), категориальные признаки кодировались OHE.

### Модели только на вещественных признаках

- Линейная регрессия (LinearRegression())
    - Значение MSE для трейна:  18.165014266967773
    - Значение MSE для теста:   10.610675811767578  
      ********************
    - Значение R^2 для трейна:  0.4199334383010864
    - Значение R^2 для теста:   0.49685168266296387  
Модель далека от совершенства, предсказывает цену посредственно.

     
- Линейная регрессия c L1-регуляризацией (Lasso()).
    - Значение MSE для трейна:  21.291772842407227
    - Значение MSE для теста:   12.486113548278809  
      ********************
    - Значение R^2 для трейна:  0.32008618116378784
    - Значение R^2 для теста:   0.4079201817512512  
Перебором параметров в диапазоне от 1 до 50000 по сетке из 50 значений подобрали коэффициент регуляризации равным alpha = 1. Значения метрики ухудшились.  
При регуляризации не занулились веса следующих признаков: 'eng_power', 'cyl_count', 'mileage'.
      
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet()).
    - Значение MSE для трейна:  20.2952938079834
    - Значение MSE для теста:   11.74767780303955  
      ********************
    - Значение R^2 для трейна:  0.351906955242157
    - Значение R^2 для теста:   0.44293612241744995  
Перебором параметров alpha в диапазоне от 1 до 50000,  l1_ratio в диапазоне от 0,01 до 1 по сетке из 50 и 20 значений соответственно подобрали alpha = 1, l1_ratio = 0,01. Значения метрики немного улучшились.

- Линейная регрессия c L2-регуляризацией (Ridge()).
    - Значение MSE для трейна:  18.1628360748291
    - Значение MSE для теста:   10.611067771911621  
      ********************
    - Значение R^2 для трейна:  0.4200030565261841
    - Значение R^2 для теста:   0.49683308601379395  
Перебором параметров alpha в диапазоне от 1 до 50000 по сетке из 100 значений соответственно подобрали alpha = 1. Значения метрики немного улучшились, но всё равно низкие.

### Модели на всех признаках после предобработки

- Линейная регрессия (LinearRegression())
    - Значение MSE для трейна:  2.5842537879943848
    - Значение MSE для теста:   3.9314258098602295  
      ********************
    - Значение R^2 для трейна:  0.9174765944480896
    - Значение R^2 для теста:   0.8135755062103271  

Метрику улучшить не удалось.
     
- Линейная регрессия c L1-регуляризацией (Lasso()).
    - Значение MSE для трейна:  21.292112350463867
    - Значение MSE для теста:   12.486257553100586  
      ********************
    - Значение R^2 для трейна:  0.3200753331184387
    - Значение R^2 для теста:   0.4079133868217468  
Перебором параметров в диапазоне от 1 до 50000 по сетке из 50 значений подобрали коэффициент регуляризации равным alpha = 1. Значения метрики сильно не улучшились.  
      
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet()).
    - Значение MSE для трейна:  20.146400451660156
    - Значение MSE для теста:   11.608393669128418  
      ********************
    - Значение R^2 для трейна:  0.3566615581512451
    - Значение R^2 для теста:   0.4495408535003662  
Перебором параметров alpha в диапазоне от 1 до 50000,  l1_ratio в диапазоне от 0,01 до 1 по сетке из 20 и 10 значений соответственно подобрали alpha = 1, l1_ratio = 0,01. Значения метрики улучшить не удалось.

- Линейная регрессия c L2-регуляризацией (Ridge()).
    - Значение MSE для трейна:  3.1570327281951904
    - Значение MSE для теста:   3.7273356914520264  
      ********************
    - Значение R^2 для трейна:  0.8991859555244446
    - Значение R^2 для теста:   0.8232532739639282  
Перебором параметров alpha в диапазоне от 1 до 50000 по сетке из 50 значений соответственно подобрали alpha = 1. Значения метрики улучшились, но всё равно невысокие.

### Модели на всех признаках после предобработки с полиномиальными числовыми признаками со степенью 2

- Линейная регрессия (LinearRegression())
    - Значение MSE для трейна:  7.215019702911377
    - Значение MSE для теста:   4.015928745269775  
      ********************
    - Значение R^2 для трейна:  0.769601583480835
    - Значение R^2 для теста:   0.8095684051513672  

Метрику улучшить не удалось.
     
- Линейная регрессия c L1-регуляризацией (Lasso()).
    - Значение MSE для трейна:  16.249038696289062
    - Значение MSE для теста:   9.580938339233398  
      ********************
    - Значение R^2 для трейна:  0.4811166524887085
    - Значение R^2 для теста:   0.5456808805465698  
Перебором параметров в диапазоне от 1 до 50000 по сетке из 50 значений подобрали коэффициент регуляризации равным alpha = 1. Значения метрики сильно не улучшились.  
      
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet()).
    - Значение MSE для трейна:  12.610238075256348
    - Значение MSE для теста:   6.570322036743164  
      ********************
    - Значение R^2 для трейна:  0.5973150730133057
    - Значение R^2 для теста:   0.6884415149688721  
Перебором параметров alpha в диапазоне от 1 до 50000,  l1_ratio в диапазоне от 0,01 до 1 по сетке из 20 и 10 значений соответственно подобрали alpha = 1, l1_ratio = 0,01. Значения метрики улучшить не удалось.

- Линейная регрессия c L2-регуляризацией (Ridge()).
    - Значение MSE для трейна:  3.995415210723877
    - Значение MSE для теста:   3.0537261962890625  
      ********************
    - Значение R^2 для трейна:  0.8724137544631958
    - Значение R^2 для теста:   0.855195164680481  
Перебором параметров alpha в диапазоне от 1 до 50000 по сетке из 50 значений соответственно подобрали alpha = 1. Значения метрики улучшились, но всё равно невысокие.

### Модели на всех признаках после предобработки с полиномиальными числовыми признаками со степенью 2 и логарифмированием целевой переменной

- Линейная регрессия (LinearRegression())
    - Значение MSE для трейна:  0.10584351420402527
    - Значение MSE для теста:   0.1070733368396759  
      ********************
    - Значение R^2 для трейна:  0.9222656488418579
    - Значение R^2 для теста:   **0.9213932156562805**  

Метрику удалсь улучшить.
     
- Линейная регрессия c L1-регуляризацией (Lasso()).
    - Значение MSE для трейна:  1.3616058826446533
    - Значение MSE для теста:   1.362436294555664  
      ********************
    - Значение R^2 для трейна:  0.0
    - Значение R^2 для теста:   -0.0002186298370361328  
Перебором параметров в диапазоне от 1 до 50000 по сетке из 50 значений подобрали коэффициент регуляризации равным alpha = 1. Значения метрики сильно не улучшились.  
      
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet()).
    - Значение MSE для трейна:  0.18689502775669098
    - Значение MSE для теста:   0.1887388378381729  
      ********************
    - Значение R^2 для трейна:  0.8627392649650574
    - Значение R^2 для теста:   **0.8614393472671509**  
Перебором параметров alpha в диапазоне от 1 до 50000,  l1_ratio в диапазоне от 0,01 до 1 по сетке из 20 и 20 значений соответственно подобрали alpha = 1, l1_ratio = 0,01. Значения метрики улучшить не удалось.

- Линейная регрессия c L2-регуляризацией (Ridge()).
    - Значение MSE для трейна:  0.07529403269290924
    - Значение MSE для теста:   0.07957988977432251  
      ********************
    - Значение R^2 для трейна:  0.9447020292282104
    - Значение R^2 для теста:   **0.9415772557258606**  
Перебором параметров alpha в диапазоне от 1 до 50000 по сетке из 50 значений соответственно подобрали alpha = 1. Значения метрики улучшились, но всё равно невысокие.

Результаты кроссвалидации (R2)
- Линейная регрессия (LinearRegression()). Просто достигнутый результат на трейне, без кроссвалидации.        
    - на числовых признаках:                                                                     0.4199334383010864
    - на всех признаках:                                                                         0.9174765944480896
    - на всех признаках плюс полиномиальные второй степени	                                     0.769601583480835
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 **0.9222656488418579**	
- Линейная регрессия с L1-регуляризацией (Lasso())
    - на числовых признаках:                                                                     0.32442446053028107
    - на всех признаках:                                                                         0.32440902292728424
    - на всех признаках плюс полиномиальные второй степени	                                     0.48402850329875946
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 $\approx 0$	
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet())
    - на числовых признаках:                                                                     0.3562881797552109
    - на всех признаках:                                                                         0.36108145117759705
    - на всех признаках плюс полиномиальные второй степени	                                     0.5990887582302094
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 **0.8625758439302444**
- Линейная регрессия с L2-регуляризацией (Ridge())
    - на числовых признаках:                                                                     0.42157092690467834
    - на всех признаках:                                                                         0.7960239201784134
    - на всех признаках плюс полиномиальные второй степени	                                     0.8307725042104721
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 **0.9423355162143707**
 
### Бизнес-метрика.

В качестве дополнительной метрики взяли долю верно спрогнозированных цен, при этом ошибка недопрогноза и перепрогноза учитывалась по-разному:
- по недопрогнозов учитывали те прогнозы, которые в пределах отклонения 5%,
- по перепрогнозам - те прогнозы, которые в пределах отклонения 10%.  
Т.е. среди всех предсказанных цен на авто посчитали долю прогнозов, отличающихся от реальных цен на эти авто не более чем на 5% в сторону уменьшения и не более чем на 10% в сторону увеличения.

Обучающая выборка
- Линейная регрессия (LinearRegression())
    - на числовых признаках:                                                                     0.5986986139
    - на всех признаках:                                                                         0.823099984
    - на всех признаках плюс полиномиальные второй степени	                                     0.7268080951
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 0.7268080951	
- Линейная регрессия с L1-регуляризацией (Lasso())
    - на числовых признаках:                                                                     0.754094484
    - на всех признаках:                                                                         0.7542470498
    - на всех признаках плюс полиномиальные второй степени	                                     0.6970959105
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 0.561792953	
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet())
    - на числовых признаках:                                                                     0.6873164443
    - на всех признаках:                                                                         0.6928698385
    - на всех признаках плюс полиномиальные второй степени	                                     0.8757656895
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 0.9055083873
- Линейная регрессия с L2-регуляризацией (Ridge())
    - на числовых признаках:                                                                     0.598912206
    - на всех признаках:                                                                         0.8123669817
    - на всех признаках плюс полиномиальные второй степени	                                     0.8452830477
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 0.9516442776	

Тестовая выборка
- Линейная регрессия (LinearRegression())
    - на числовых признаках:                                                                     0.598266866
    - на всех признаках:                                                                         0.8024288286
    - на всех признаках плюс полиномиальные второй степени	                                     0.7236139505
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 **0.936838251**	
- Линейная регрессия с L1-регуляризацией (Lasso())
    - на числовых признаках:                                                                     0.752051994
    - на всех признаках:                                                                         0.7519299423
    - на всех признаках плюс полиномиальные второй степени	                                     0.6943215452
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 0.5659536814	
- Линейная регрессия c комбинацией L1 и L2-регуляризации (ElasticNet())
    - на числовых признаках:                                                                     0.6823299667
    - на всех признаках:                                                                         0.6856253623
    - на всех признаках плюс полиномиальные второй степени	                                     0.8753852256
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 **0.9063253288**
- Линейная регрессия с L2-регуляризацией (Ridge())
    - на числовых признаках:                                                                     0.5990296891
    - на всех признаках:                                                                         0.7949531627
    - на всех признаках плюс полиномиальные второй степени	                                     0.8384340768
    - на всех признаках плюс полиномиальные второй степени и логарифмированием целевой функции	 **0.9500808592**	
 
Получили модель, построеннаую на полиномиальных и категориальных признаках, полученных после предобработки ранее созданным предобработчиком, с последующим логарифмированием целевой переменной с R2=0.94 и долей предсказанных цен в диапазоне 0,95-1,1 от реальной цены 0,95.
Полагаем, что модель весьма удачная, показывает хорошие результаты и на кроссвалидации, и на тесте. 
